# Streamlit UI 使用指南

## 功能概览

智能审核系统提供了一个美观、易用的Web界面，包含以下功能模块：

### 📊 首页统计
- 实时审核数据概览
- 审核结果分布图表
- 违规类型统计
- 系统状态监控

### 🔍 内容审核
- **文本审核**：输入文本内容进行实时审核
- **图片审核**：上传图片进行OCR识别和审核
- **批量审核**：上传CSV文件进行批量处理

### 📋 审核历史
- 查看历史审核记录
- 按类型和结果筛选
- 查看详细审核信息

### ⚙️ 系统配置
- API密钥管理
- 规则热更新
- 系统统计信息

## 快速启动

### 方法1：使用启动脚本（推荐）

```bash
# 在项目根目录执行
python run_ui.py
```

### 方法2：直接使用Streamlit

```bash
# 在项目根目录执行
streamlit run ui/app.py --server.port 8501
```

### 方法3：使用pipenv

```bash
# 在项目根目录执行
pipenv run streamlit run ui/app.py
```

启动后，浏览器会自动打开 `http://localhost:8501`

## 使用示例

### 文本审核示例

1. 进入"🔍 内容审核"页面
2. 选择"📝 文本审核"
3. 输入待审核内容，例如：
   ```
   全网最低价！100%有效！立即购买送豪礼！
   ```
4. 点击"🚀 开始审核"
5. 查看审核结果，包括：
   - 合规性判断
   - 置信度评分
   - 违规类型
   - 处理时间和成本
   - 详细分析和证据

### 图片审核示例

1. 进入"🔍 内容审核"页面
2. 选择"🖼️ 图片审核"
3. 上传包含文字的图片
4. 点击"🚀 开始审核"
5. 系统会自动：
   - 使用OCR提取图片中的文字
   - 对提取的文字进行审核
   - 显示完整的审核结果

### 批量审核示例

1. 准备CSV文件，包含`content`列：
   ```csv
   content
   "全网最低价！100%有效！"
   "正常的商品描述"
   "添加微信：123456获取优惠"
   ```

2. 进入"🔍 内容审核"页面
3. 选择"📦 批量审核"
4. 上传CSV文件
5. 点击"🚀 开始批量审核"
6. 等待处理完成
7. 查看结果并下载审核报告

## 界面功能说明

### 首页统计卡片

- **今日审核量**：显示当天处理的审核数量
- **审核准确率**：系统的整体准确率
- **平均响应时间**：单次审核的平均耗时
- **单条成本**：平均每条审核的API成本

### 审核结果展示

审核完成后会显示：

1. **结果概览**
   - ✅ 审核通过（绿色）
   - ❌ 审核不通过（红色）

2. **关键指标**
   - 置信度：模型对结果的确信程度
   - 处理时间：审核耗时
   - 审核成本：API调用费用

3. **违规详情**
   - 违规类型列表
   - 具体违规证据
   - 推理过程说明

4. **审核链路**
   - 规则引擎检测结果
   - OCR提取信息（图片审核）
   - RAG检索结果
   - LLM审核结论

### 系统配置

在"⚙️ 系统配置"页面可以：

- 查看和更新API密钥
- 重载规则配置（无需重启）
- 查看系统统计信息
- 监控Token使用量和成本

## 注意事项

1. **首次使用**
   - 确保已配置`.env`文件中的API密钥
   - 确保已安装所有依赖：`pipenv install`

2. **性能优化**
   - 批量审核建议每批不超过1000条
   - 图片大小建议不超过5MB
   - 长文本建议分段审核

3. **错误处理**
   - 如果审核失败，会显示具体错误信息
   - 可以在系统配置页面检查服务状态
   - 查看控制台日志获取详细错误

4. **数据安全**
   - 审核历史仅保存在session中
   - 刷新页面会清空历史记录
   - 临时上传的图片会自动清理

## 技术架构

UI基于以下技术栈：

- **Streamlit**：Web框架
- **Pandas**：数据处理
- **Pillow**：图片处理
- **后端集成**：直接调用Pipeline和各服务

## 自定义配置

### 修改端口

编辑`run_ui.py`：

```python
os.system(f"streamlit run {project_root}/ui/app.py --server.port 8080")
```

### 修改主题

创建`.streamlit/config.toml`：

```toml
[theme]
primaryColor = "#1f77b4"
backgroundColor = "#ffffff"
secondaryBackgroundColor = "#f0f2f6"
textColor = "#262730"
font = "sans serif"
```

### 添加自定义页面

在`ui/app.py`的`main()`函数中添加新页面：

```python
page = st.sidebar.radio(
    "导航",
    ["📊 首页统计", "🔍 内容审核", "📋 审核历史", "⚙️ 系统配置", "🆕 新页面"]
)

if page == "🆕 新页面":
    show_custom_page()
```

## 故障排查

### 问题1：无法启动

**症状**：运行启动命令后报错

**解决方案**：
```bash
# 检查依赖
pipenv install streamlit pandas

# 检查Python版本
python --version  # 需要3.8+

# 查看详细错误
streamlit run ui/app.py --logger.level=debug
```

### 问题2：审核失败

**症状**：点击审核按钮后显示错误

**解决方案**：
1. 检查`.env`文件中的API密钥是否正确
2. 确认网络连接正常
3. 查看系统配置页面的服务状态
4. 检查控制台日志

### 问题3：页面加载慢

**症状**：页面响应缓慢

**解决方案**：
1. 减少批量审核的数量
2. 压缩上传的图片大小
3. 检查网络延迟
4. 考虑使用缓存优化

## 更新日志

### v1.0.0 (2024-01-01)
- ✅ 实现首页统计
- ✅ 实现文本审核
- ✅ 实现图片审核
- ✅ 实现批量审核
- ✅ 实现审核历史
- ✅ 实现系统配置
- ✅ 集成Pipeline和所有服务
- ✅ 完整的错误处理
- ✅ 美观的UI设计

## 反馈与支持

如有问题或建议，请：
1. 查看本文档的故障排查部分
2. 查看项目主README
3. 提交Issue到项目仓库
